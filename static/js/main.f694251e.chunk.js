(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{179:function(e,t,a){e.exports=a.p+"static/media/no-image.301ce772.png"},182:function(e,t,a){e.exports=a.p+"static/media/Draw.17b6a969.png"},183:function(e,t,a){e.exports=a.p+"static/media/Resign.5997b080.png"},185:function(e,t,a){e.exports=a.p+"static/media/rook-black.3d52ae77.png"},186:function(e,t,a){e.exports=a.p+"static/media/rook-mixed.f81d7ebe.png"},187:function(e,t,a){e.exports=a.p+"static/media/rook-white.285f87a2.png"},189:function(e,t,a){e.exports=a.p+"static/media/spinner.5fe4039b.gif"},192:function(e,t,a){e.exports=a(500)},197:function(e,t,a){},200:function(e,t,a){},203:function(e,t,a){},204:function(e,t,a){},205:function(e,t,a){},206:function(e,t,a){},207:function(e,t,a){},208:function(e,t,a){},209:function(e,t,a){},210:function(e,t,a){},211:function(e,t,a){},212:function(e,t,a){},213:function(e,t,a){},230:function(e,t){},245:function(e,t,a){},246:function(e,t,a){},298:function(e,t,a){},399:function(e,t,a){},401:function(e,t,a){},411:function(e,t){},413:function(e,t){},417:function(e,t){},419:function(e,t){},450:function(e,t){},451:function(e,t){},497:function(e,t,a){},498:function(e,t,a){},500:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),o=a(96),r=a.n(o),i=(a(197),a(5)),c=a(6),l=a(3),u=a(7),m=a(8),p=(a(99),a(501)),h=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={title:a.props.title?a.props.title:"SteemChess",url:"http://localhost:3000"},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("header",null,s.a.createElement("h1",null,this.state.title),s.a.createElement("ul",{id:"menubar-list"},s.a.createElement("li",null,s.a.createElement(p.a,{to:"/Play"},"Play")),s.a.createElement("li",null,s.a.createElement(p.a,{to:"/"},"Trending")),s.a.createElement("li",null,s.a.createElement(p.a,{to:"/New"},"New")),s.a.createElement("li",null,s.a.createElement(p.a,{to:"/Hot"},"Hot")),s.a.createElement("li",null,s.a.createElement(p.a,{to:"/Compose"},"Compose")),s.a.createElement("li",null,s.a.createElement(p.a,{to:"/Login"},null===localStorage.getItem("login")?"Login":"Logout"))),s.a.createElement("h1",null))}}]),t}(n.Component),d=function(){return s.a.createElement("footer",{className:"App-footer"},"\xa9 SteemChess ",(new Date).getFullYear())},g=function(e){var t=e.children;return s.a.createElement("main",{className:"App-content"},t)},b=a(503),f=a(502),v=(a(200),a(15)),y=(a(203),a(179)),k=a.n(y),O=function(e){function t(e){var a;Object(i.a)(this,t),a=Object(l.a)(this,Object(u.a)(t).call(this,e));var n=JSON.parse(a.props.post.json_metadata);return a.state={image:n.image?n.image[0]:"",title:a.props.post.title,author:a.props.post.author,permlink:a.props.post.permlink,created:new Date(a.props.post.created).toDateString()},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"PostPreview"},s.a.createElement("p",null,"by ",this.state.author),s.a.createElement("p",{class:"list-group-item-text text-right text-nowrap"},this.state.created),s.a.createElement(p.a,{to:"Post/@".concat(this.state.author,"/").concat(this.state.permlink),class:"articlelink"},s.a.createElement("center",{class:"crop"},this.state.image?s.a.createElement("img",{src:this.state.image,class:"img-responsive center-block",alt:""}):s.a.createElement("img",{src:k.a,alt:"No Image"})),s.a.createElement("p",{className:"link"},this.state.title)))}}]),t}(n.Component),C=new v.Client("https://api.steemit.com"),j=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={posts:[]},a.fetchBlog(a.props.limit,a.props.sortMethod),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"fetchBlog",value:function(){var e=this,t={tag:"chess",limit:this.props.limit};C.database.getDiscussions(this.props.sortMethod,t).then(function(t){t.forEach(function(t){e.state.posts.push(s.a.createElement(O,{post:t}))}),e.forceUpdate()}).catch(function(e){alert("Error occured: "+e)})}},{key:"render",value:function(){return s.a.createElement("div",{className:"ArticleFeed"},s.a.createElement("div",{class:"list-group",id:"postList"},this.state.posts.map(function(e){return s.a.createElement("div",null," ",e," ")})))}}]),t}(n.Component),E=a(11),w=a.n(E),S=a(19),D=a(2),T=a(36),x=(a(204),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={messageList:a.props.messageList?a.props.messageList:[],peer:a.props.peer,draftedMessage:""},a.updateDraft=a.updateDraft.bind(Object(D.a)(Object(D.a)(a))),a.sendMessage=a.sendMessage.bind(Object(D.a)(Object(D.a)(a))),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onReceiveMessage",value:function(e){console.log("Received data from peer!"),this.state.messageList.push([e.message,Date.now(),!0]),this.setState({messageList:this.state.messageList})}},{key:"updateDraft",value:function(e){this.setState({draftedMessage:e.target.value})}},{key:"sendMessage",value:function(){this.isEmptyOrSpaces(this.state.draftedMessage)||(this.props.sendData({type:"message",timeSent:Date.now(),message:this.state.draftedMessage}),this.state.messageList.push([this.state.draftedMessage,Date.now(),!1]),this.setState({messageList:this.state.messageList}),this.setState({draftedMessage:""}),this.refs.draftArea.value="")}},{key:"isEmptyOrSpaces",value:function(e){return null===e||null!==e.match(/^ *$/)}},{key:"render",value:function(){var e,t=this;return null!=this.state.messageList&&(e=this.state.messageList.map(function(e,t){var a=Object(T.a)(e,3),n=a[0],o=a[1],r=a[2];return s.a.createElement(q,{key:t,message:n.toString(),timeSent:o,fromOpponent:r})})),s.a.createElement("section",{id:"messages-main"},s.a.createElement("section",{id:"messages-list",className:"messages-list"},s.a.createElement("span",null,e)),s.a.createElement("section",{id:"new-message",className:"new-msg"},s.a.createElement("textarea",{ref:"draftArea",className:"msg",onChange:function(e){return t.updateDraft(e)}}),s.a.createElement("button",{onClick:function(e){return t.sendMessage()},id:"Send"},"Send")))}}]),t}(n.Component)),q=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={message:a.props.message,timeSent:a.props.timeSent,fromOpponent:a.props.fromOpponent},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"getFormattedTime",value:function(e){var t=new Date(e),a=t.getHours(),n="0"+t.getMinutes(),s="0"+t.getSeconds();return a+":"+n.substr(-2)+":"+s.substr(-2)}},{key:"render",value:function(){var e=this.getFormattedTime(this.state.timeSent);return s.a.createElement("div",{className:this.state.fromOpponent?"chatbox-message-opponent":"chatbox-message-mine"},s.a.createElement("div",{className:this.state.fromOpponent?"chatbox-bubble-opponent":"chatbox-bubble-mine"},s.a.createElement("h1",null,this.state.message)),s.a.createElement("h5",{className:"message-content-end"},e))}}]),t}(n.Component),P=x,B=a(21),M=a(26),N=a(30),R=a(180),L=a.n(R),G=a(181),I=a.n(G),A=(a(205),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={fen:"start",squareStyles:{},pieceSquare:""},null==a.props.gameData?console.error("ChessGame component not passed any game data"):(console.log("Chess game props: ",a.props.gameData),a.gameData=a.props.gameData,a.color=a.gameData.startingColor[0].toLowerCase()),a.gameOver=!1,a.myTurn="w"===a.color,a.opponentColor="w"===a.color?"b":"w",a.dropSquareStyle={boxShadow:"inset 0 0 1px 4px rgb(255, 255, 0)"},a.history=[],a.removeHighlightSquare=a.removeHighlightSquare.bind(Object(D.a)(Object(D.a)(a))),a.highlightSquare=a.highlightSquare.bind(Object(D.a)(Object(D.a)(a))),a.onDrop=a.onDrop.bind(Object(D.a)(Object(D.a)(a))),a.onMouseOverSquare=a.onMouseOverSquare.bind(Object(D.a)(Object(D.a)(a))),a.onMouseOutSquare=a.onMouseOutSquare.bind(Object(D.a)(Object(D.a)(a))),a.onReceiveMove=a.onReceiveMove.bind(Object(D.a)(Object(D.a)(a))),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.game=new I.a}},{key:"onReceiveMove",value:function(e){console.log("Received move from other player!"),e.color===this.opponentColor?this.isValidMove(e.sourceSquare,e.targetSquare)&&(this.commitPieceMove(e.sourceSquare,e.targetSquare),this.myTurn=!0):console.warn("Opponent tried to move wrong piece and it went through!")}},{key:"removeHighlightSquare",value:function(){var e=this;this.setState(function(t){var a=t.pieceSquare;return{squareStyles:e.squareStyling(a,e.history)}})}},{key:"highlightSquare",value:function(e,t){var a=this,n=[e].concat(Object(N.a)(t)).reduce(function(e,t){return Object(M.a)({},e,Object(B.a)({},t,{background:"radial-gradient(circle, #fffc00 36%, transparent 40%)",borderRadius:"50%"}),a.squareStyling(a.state.pieceSquare,a.history))},{});this.setState(function(e){var t=e.squareStyles;return{squareStyles:Object(M.a)({},t,n)}})}},{key:"onDrop",value:function(e){this.gameOver||(this.myTurn?this.isValidMove(e.sourceSquare,e.targetSquare)?this.props.sendData({type:"move",sourceSquare:e.sourceSquare,targetSquare:e.targetSquare,piece:e.piece,time:Date.now,move:this.game.fen(),color:this.color})?(this.commitPieceMove(e.sourceSquare,e.targetSquare),this.myTurn=!1):console.error("Failed to send move to opponent"):console.warn("Tried to move to an invalid square"):console.warn("Tried to move a piece while it was the opponent's turn"))}},{key:"isValidMove",value:function(e,t){var a=this.game.moves({square:e}),n=[];return a.forEach(function(e){var t=e;"+"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),"#"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t.includes("=")&&(t=t.substring(0,t.length-2)),n.push(t.substring(t.length-2,t.length))}),console.log("available moves",a,e,t),null!=n&&n.indexOf(t)>=0}},{key:"commitPieceMove",value:function(e,t){var a=this;this.game.move({from:e,to:t,promotion:"q"}),this.setState(function(e){var t=e.pieceSquare;return{fen:a.game.fen(),squareStyles:a.squareStyling(t,a.history)}});var n=this.game.history({verbose:!0}),s=n[n.length-1];this.props.addMoveToHistory(s,Date.now()),this.history.push(s),console.log(this.game),this.game.in_stalemate()?(this.props.gameEnded("stalemate"),alert("Stalemate!")):this.game.in_draw()?(this.props.gameEnded("draw"),alert("A Draw!")):this.game.in_checkmate()&&(this.myTurn?this.props.gameEnded("checkmate won"):this.props.gameEnded("checkmate lost"),alert("Checkmate!"))}},{key:"onMouseOverSquare",value:function(e){if(!this.gameOver&&this.myTurn){var t=this.game.moves({square:e,verbose:!0});if(0!==t.length){for(var a=[],n=0;n<t.length;n++)a.push(t[n].to);this.highlightSquare(e,a)}}}},{key:"onMouseOutSquare",value:function(e){this.removeHighlightSquare(e)}},{key:"squareStyling",value:function(e,t){var a=t.length&&t[t.length-1].from,n=t.length&&t[t.length-1].to;return Object(M.a)(Object(B.a)({},e,{backgroundColor:"rgba(255, 255, 0, 0.4)"}),t.length&&Object(B.a)({},a,{backgroundColor:"rgba(255, 255, 0, 0.4)"}),t.length&&Object(B.a)({},n,{backgroundColor:"rgba(255, 255, 0, 0.4)"}))}},{key:"endGame",value:function(){this.gameOver=!0}},{key:"getGameHistory",value:function(){return this.history}},{key:"render",value:function(){var e=this,t=this.state.squareStyles;return s.a.createElement(L.a,{id:"chessboard",position:this.state.fen,onDrop:function(t){return e.onDrop(t)},orientation:"b"===this.color?"black":"white",onMouseOverSquare:function(t){return e.onMouseOverSquare(t)},onMouseOutSquare:function(t){return e.onMouseOutSquare(t)},squareStyles:t,dropSquareStyle:this.dropSquareStyle})}}]),t}(n.PureComponent)),H=(a(206),{wp:"\u2659",wn:"\u2658",wr:"\u2656",wb:"\u2657",wq:"\u2655",bp:"\u265f",bn:"\u265e",br:"\u265c",bb:"\u265d",bq:"\u265b"}),U=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={whiteMoves:[],blackMoves:[]},a.history=[],a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"addMove",value:function(e,t){"w"===e.color?this.setState({whiteMoves:[].concat(Object(N.a)(this.state.whiteMoves),[[e,t]])}):this.setState({blackMoves:[].concat(Object(N.a)(this.state.blackMoves),[[e,t]])})}},{key:"render",value:function(){var e,t;return null!=this.state.whiteMoves&&(e=this.state.whiteMoves.map(function(e,t){var a=Object(T.a)(e,2),n=a[0],o=a[1];return s.a.createElement(V,{key:t,move:n,time:o})})),null!=this.state.blackMoves&&(t=this.state.blackMoves.map(function(e,t){var a=Object(T.a)(e,2),n=a[0],o=a[1];return s.a.createElement(V,{key:t,move:n,time:o})})),s.a.createElement("div",{id:"history-main-div"},s.a.createElement("section",{id:"history-headers"},s.a.createElement("div",{id:"history-white-header"},"White"),s.a.createElement("div",{id:"history-black-header"},"Black")),s.a.createElement("div",{id:"history-moves-div"},s.a.createElement("section",{id:"white-history-box"},s.a.createElement("span",null,e)),s.a.createElement("section",{id:"black-history-box"},s.a.createElement("span",null,t))))}}]),t}(n.Component),V=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={move:a.props.move,time:a.props.time},console.log("created a move!"),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"getFormattedMove",value:function(){if(null==this.state.move||void 0==this.state.move)return"";var e="";if(void 0!==this.state.move.captured){var t="w"===this.state.move.color?"b":"w";e+=H[t+this.state.move.captured]+" "}return e+(this.state.move.from+" \u2192 ")+this.state.move.to}},{key:"getFormattedTime",value:function(){var e=new Date(this.state.time),t=e.getHours(),a="0"+e.getMinutes(),n="0"+e.getSeconds();return t+":"+a.substr(-2)+":"+n.substr(-2)}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("h4",{className:"move"},this.getFormattedMove()),s.a.createElement("h6",{className:"time"},this.getFormattedTime()))}}]),t}(n.Component),F=U,K=(a(207),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={gameType:a.props.gameType,gameTime:a.props.gameTime,increment:a.props.increment,ranked:a.props.ranked,black:a.props.black,white:a.props.white},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{id:"game-info-box"},s.a.createElement("div",{className:"Top"},s.a.createElement("h4",null,this.state.gameType," ",this.state.gameTime," - ",this.state.increment," ",this.state.ranked)),s.a.createElement("div",{className:"Bottom"},s.a.createElement("h4",null,this.state.black),s.a.createElement("h4",null,this.state.white)))}}]),t}(n.Component)),_=(a(208),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={ended:!1,display:null,timerColor:"timer-paused"},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"initialize",value:function(){this.startTime=Date.now(),this.on=!1;var e=0,t=0,a=0;null!=this.props.hours&&(e=this.props.hours),null!=this.props.minutes&&(t=this.props.minutes),null!=this.props.seconds&&(a=this.props.seconds),this.timeLeft=1e3*(60*(60*e+t)+a),this.updateDisplay()}},{key:"start",value:function(e){this.setState({timerColor:"timer-on"}),isNaN(e)&&(e=Date.now()),this.on=!0,this.endTime=e+this.timeLeft,this.tickLoop()}},{key:"tickLoop",value:function(){var e=this;setTimeout(function(){e.updateDisplay(),e.timeLeft=e.endTime-Date.now(),e.on&&(e.timeLeft<=0&&(e.on=!1,e.setState({timerColor:"timer-finished"}),e.props.timesUp()),e.tickLoop())},1e3/30)}},{key:"pause",value:function(){this.setState({timerColor:"timer-paused"}),this.on=!1}},{key:"stop",value:function(){"timer-paused"===this.state.timerColor&&this.setState({timerColor:"timer-blank"}),this.on=!1}},{key:"addTime",value:function(e){isNaN(e)||(this.on?this.endTime=this.endTime+1e3*e:this.timeLeft=this.timeLeft+1e3*e)}},{key:"updateDisplay",value:function(){var e=Math.max(0,Math.floor(this.timeLeft/6e4));e<10&&(e="0"+e);var t=Math.max(0,Math.floor(this.timeLeft%6e4/1e3));t<10&&(t="0"+t),this.setState({display:e+":"+t})}},{key:"render",value:function(){return s.a.createElement("div",{className:"current-timer "+this.state.timerColor},this.state.display)}}]),t}(n.Component)),W=(a(209),a(182)),J=a.n(W),z=a(183),Y=a.n(z),$=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).gameFinished=!1,a.onDrawClicked=a.onDrawClicked.bind(Object(D.a)(Object(D.a)(a))),a.onResignClicked=a.onResignClicked.bind(Object(D.a)(Object(D.a)(a))),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onDrawClicked",value:function(e){!this.gameFinished&&window.confirm("Are you sure you want to request a draw?")&&this.props.drawClicked()}},{key:"onResignClicked",value:function(e){!this.gameFinished&&window.confirm("Are you sure you want to resign?")&&this.props.resignClicked()}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"gameOptionsDiv"},s.a.createElement("img",{onClick:function(t){return e.onDrawClicked(t)},className:"gameOption",src:J.a,alt:"Draw"}),s.a.createElement("img",{onClick:function(t){return e.onResignClicked(t)},className:"gameOption",src:Y.a,alt:"Resign"}))}}]),t}(n.Component),Q=function(){try{return{account:localStorage.getItem("account"),key:localStorage.getItem("pKey"),login:localStorage.getItem("login")}}catch(e){return null}},X=(a(210),a(15)),Z=a(100),ee=new X.Client("https://api.steemit.com"),te=function(e){function t(e){var a;return Object(i.a)(this,t),a=Object(l.a)(this,Object(u.a)(t).call(this,e)),console.log(a.props),a.peer=a.props.location.peer,a.chatboxComponent=s.a.createRef(),a.chessGameComponent=s.a.createRef(),a.opponentTimerComponent=s.a.createRef(),a.myTimerComponent=s.a.createRef(),a.gameHistoryComponent=s.a.createRef(),a.gameOptionsComponent=s.a.createRef(),a.gameFinished=!1,null!=a.props.location.gameData?a.gameData=a.props.location.gameData:a.gameData=null,a.sendPeerData=a.sendPeerData.bind(Object(D.a)(Object(D.a)(a))),a.opponentTimesUp=a.opponentTimesUp.bind(Object(D.a)(Object(D.a)(a))),a.myTimesUp=a.myTimesUp.bind(Object(D.a)(Object(D.a)(a))),a.addMoveToHistory=a.addMoveToHistory.bind(Object(D.a)(Object(D.a)(a))),a.gameDataParser=a.gameDataParser.bind(Object(D.a)(Object(D.a)(a))),a.stopTimers=a.stopTimers.bind(Object(D.a)(Object(D.a)(a))),a.gameHasEnded=a.gameHasEnded.bind(Object(D.a)(Object(D.a)(a))),a.drawClicked=a.drawClicked.bind(Object(D.a)(Object(D.a)(a))),a.resignClicked=a.resignClicked.bind(Object(D.a)(Object(D.a)(a))),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillUnmount",value:function(){null!==this.peer&&void 0!==this.peer&&this.peer.destroy(),this.stopTimers()}},{key:"componentDidMount",value:function(){var e=Object(S.a)(w.a.mark(function e(){var t,a=this;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=Q()).account){e.next=7;break}return console.log("Went to LiveMatch without logging in"),this.props.history.push("/Login"),e.abrupt("return");case 7:this.username=t.account;try{this.posting_key=X.PrivateKey.fromString(t.key)}catch(n){console.error(n)}case 9:if(null!=this.gameData){e.next=13;break}return this.props.history.push("/Play"),console.error("LiveMatch not passed any game data!"),e.abrupt("return");case 13:if(null!=this.peer){e.next=17;break}return this.props.history.push("/Play"),console.error("LiveMatch not passed a peer!"),e.abrupt("return");case 17:"White"===this.gameData.startingColor?this.myTimerComponent.current.start():this.opponentTimerComponent.current.start(),e.next=20;break;case 20:this.peer.on("data",function(e){var t=JSON.parse(e);console.log("got peer data",t),"message"===t.type?a.chatboxComponent.current.onReceiveMessage(t):"move"===t.type?(a.chessGameComponent.current.onReceiveMove(t),a.opponentTimerComponent.current.pause(),a.opponentTimerComponent.current.addTime(a.gameDataParser(2)),a.myTimerComponent.current.start()):"draw request"===t.type?(a.stopTimers(),window.confirm("Opponent requested a draw. Do you want to accept?")?a.sendPeerData({type:"draw accepted"}):a.sendPeerData({type:"draw denied"})):"draw accepted"===t.type?a.gameHasEnded("sent draw"):"draw denied"===t.type?a.resumeTimers():"resigned"===t.type&&a.gameHasEnded("opponent resigned")});case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sendPeerData",value:function(e){return"move"===e.type?(this.myTimerComponent.current.pause(),this.myTimerComponent.current.addTime(this.gameDataParser(2)),this.opponentTimerComponent.current.start()):"resigned"===e.type?(this.gameHasEnded("resigned"),alert("You have successfully resigned")):"draw request"===e.type?this.stopTimers():"draw accepted"===e.type?this.gameHasEnded("accepted draw"):"draw denied"===e.type&&this.resumeTimers(),null==this.peer?(console.error("Peer connection not initiated!"),alert("Peer connection not initiated!"),!1):this.peer.connected?(this.peer.send(JSON.stringify(e)),!0):(console.error("Not connected to the other player yet!"),alert("Not connected to the other player yet!"),!1)}},{key:"opponentTimesUp",value:function(){this.gameHasEnded("opponent timer ended"),alert("You win!! Opponent ran out of time")}},{key:"myTimesUp",value:function(){this.gameHasEnded("my timer ended"),alert("Sorry, you lose! You ran out of time")}},{key:"addMoveToHistory",value:function(e,t){this.gameHistoryComponent.current.addMove(e,t)}},{key:"stopTimers",value:function(){null!==this.myTimerComponent.current&&this.myTimerComponent.current.stop(),null!==this.opponentTimerComponent.current&&this.opponentTimerComponent.current.stop()}},{key:"resumeTimers",value:function(){null!==this.myTimerComponent.current&&this.myTimerComponent.current.start(),null!==this.opponentTimerComponent.current&&this.opponentTimerComponent.current.start()}},{key:"gameHasEnded",value:function(e){var t;console.log(this),this.gameFinished=!0,this.gameOptionsComponent.current.gameFinished=!0,this.chessGameComponent.current.endGame(),this.stopTimers(),"checkmate won"===e?t=this.username+" beat "+this.props.opponentUsername:"checkmate lost"===e?t=this.props.opponentUsername+" beat "+this.username:"stalemate"===e?t=this.props.opponentUsername+" got in a stalemate with "+this.username:"my timer ended"===e?t=this.username+" ran out of time":"opponent timer ended"===e?t=this.props.opponentUsername+" ran out of time":"resigned"===e?t=this.props.opponentUsername+" resigned in game with "+this.username:"opponent resigned"===e?t=this.username+" resigned in game with "+this.props.opponentUsername:"sent draw"===e?t=this.props.opponentUsername+" accepted draw from "+this.username:"accepted draw"===e&&(t=this.username+" accepted draw from "+this.props.opponentUsername);var a={endStatus:t,history:this.chessGameComponent.current.getGameHistory()};Z(ee,X,"steem-chess-").json(this.username,this.posting_key.toString(),"game-ended",a,function(e,t){e&&console.error(e)})}},{key:"drawClicked",value:function(){this.sendPeerData({type:"draw request"})}},{key:"resignClicked",value:function(){this.sendPeerData({type:"resigned"})}},{key:"gameDataParser",value:function(e){if(null===this.gameData)return"";var t=this.gameData.typeID.split("|");return t.length>e?t[e]:void 0}},{key:"render",value:function(){return s.a.createElement("div",{id:"Match"},s.a.createElement("div",{id:"float-left"},s.a.createElement(K,{gameType:this.gameDataParser(0),gameTime:this.gameDataParser(1),increment:this.gameDataParser(2),ranked:!1}),s.a.createElement(P,{sendData:this.sendPeerData,ref:this.chatboxComponent})),s.a.createElement("div",{id:"middle-div"},s.a.createElement(A,{sendData:this.sendPeerData,addMoveToHistory:this.addMoveToHistory,ref:this.chessGameComponent,gameData:this.gameData,gameEnded:this.gameHasEnded})),s.a.createElement("div",{id:"float-right"},s.a.createElement(_,{timesUp:this.myTimesUp,ref:this.myTimerComponent,minutes:this.gameDataParser(1)}),s.a.createElement(_,{timesUp:this.opponentTimesUp,ref:this.opponentTimerComponent,minutes:this.gameDataParser(1)}),s.a.createElement($,{ref:this.gameOptionsComponent,drawClicked:this.drawClicked,resignClicked:this.resignClicked}),s.a.createElement(F,{ref:this.gameHistoryComponent})))}}]),t}(n.Component),ae=(a(211),a(212),a(213),a(184)),ne=a.n(ae),se="https://api.steemit.com",oe={addressPrefix:"STM",chainId:"0000000000000000000000000000000000000000000000000000000000000000"},re=(a(245),a(246),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={value:a.props.value?a.props.value:0},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"valueChanged",value:function(e){this.setState({value:e.target.value}),this.props.onValueChanged(e.target.value)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"slidecontainer"},s.a.createElement("p",null,this.state.value," ",this.props.unit),s.a.createElement("input",{type:"range",min:this.props.min?this.props.min:0,max:this.props.max?this.props.max:100,step:this.props.step?this.props.step:1,value:this.state.value,className:"slider",id:"myRange",onChange:function(t){return e.valueChanged(t)}}))}}]),t}(n.Component)),ie=new v.Client("https://api.steemit.com"),ce=(Object(M.a)({},oe),function(e){function t(e){var a;Object(i.a)(this,t),a=Object(l.a)(this,Object(u.a)(t).call(this,e));var n=Q();return a.state={account:n.account,key:n.key,author:a.props.author,permlink:a.props.permlink,weight:0,weightId:"voteWeight"+a.props.id,voteButtonValue:"Open voting UI",expanded:!1},a.pushVote=a.pushVote.bind(Object(D.a)(Object(D.a)(a))),a.expandDropdown=a.expandDropdown.bind(Object(D.a)(Object(D.a)(a))),a.closeDropdown=a.closeDropdown.bind(Object(D.a)(Object(D.a)(a))),a.weightChanged=a.weightChanged.bind(Object(D.a)(Object(D.a)(a))),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"pushVote",value:function(){if(null!=this.state.account){var e;try{e=v.PrivateKey.fromString(this.state.key)}catch(a){return console.error(a),"private key network id mismatch"===a.message?(alert("Bad password, please login again."),void this.props.history.push("/Login")):(alert("An error occurred when generating key. See console for details."),void this.props.history.push("/"))}if(0!==this.state.weight){var t={voter:this.state.account,author:this.state.author,permlink:this.state.permlink,weight:parseInt(this.state.weight)};ie.broadcast.vote(t,e).then(function(e){console.log("Success! Vote Has Been Submitted:",e),alert("Success.")},function(e){if(console.error(e),e.message.includes("unknown key"))return alert("Bad username, please login again."),void this.props.history.push("/Login");alert("An error occurred when broadcasting. See console for details.")})}else alert("Please select a weight for your vote.")}else this.props.history.push("/Login")}},{key:"handleClick",value:function(){0==this.state.expanded?this.expandDropdown():this.closeDropdown()}},{key:"expandDropdown",value:function(){this.setState({expanded:!0}),this.setState({voteButtonValue:"Close voting UI"})}},{key:"closeDropdown",value:function(){this.setState({expanded:!1}),this.setState({voteButtonValue:"Open voting UI"})}},{key:"weightChanged",value:function(e){this.setState({weight:e})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"upvote"},s.a.createElement("div",{id:"upVote"},s.a.createElement("br",null),s.a.createElement("button",{onClick:function(){return e.handleClick()},id:"openVotes",class:"smallBtn"},this.state.voteButtonValue),this.state.expanded?s.a.createElement(re,{id:this.state.weightId,min:"-10000",max:"10000",step:"100",onValueChanged:this.weightChanged,class:"input"}):null,this.state.expanded?s.a.createElement("button",{id:"pushVoteBtn",class:"smallBtn",onClick:function(){return e.pushVote()}},"Push vote"):null))}}]),t}(n.Component)),le=new(a(112))({html:!0,linkify:!0}),ue=function(e){function t(e){var a;Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).fetchComments=a.props.fetchComments.bind(Object(D.a)(Object(D.a)(a))),a.pushComment=a.props.pushComment.bind(Object(D.a)(Object(D.a)(a))),a.expandDropdown=a.expandDropdown.bind(Object(D.a)(Object(D.a)(a))),a.closeDropdown=a.closeDropdown.bind(Object(D.a)(Object(D.a)(a)));var n=a.props.id.replace(/^\D+/g,"");return a.state={expanded:!1,comments:[],commentAuthor:a.props.comment.author,commentPermlink:a.props.comment.permlink,numericId:n,commentBodyId:a.props.id,replyButtonValue:"Open replies"},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"handleClick",value:function(){0==this.state.expanded?this.expandDropdown():this.closeDropdown()}},{key:"expandDropdown",value:function(){this.fetchComments(this.state.commentAuthor,this.state.commentPermlink,this.state.numericId,this.props.fetchComments),this.setState({expanded:!0}),this.setState({replyButtonValue:"Close replies"})}},{key:"closeDropdown",value:function(){this.setState({expanded:!1}),this.setState({replyButtonValue:"Open replies"})}},{key:"render",value:function(){var e=this,t=le.render(this.props.comment.body);return s.a.createElement("div",{id:"Comment",className:"Comment"},s.a.createElement("div",{class:"list-group-item list-group-item-action flex-column align-items-start"},s.a.createElement("div",{class:"d-flex w-100 justify-content-between"},s.a.createElement("h5",{class:"mb-1"},"@",this.state.commentAuthor),s.a.createElement("small",{class:"text-muted"},new Date(this.props.comment.created).toString())),s.a.createElement("p",{class:"mb-1"},ne()(t)),s.a.createElement("small",{class:"text-muted"},"\u25b2 $",this.props.comment.net_votes)),s.a.createElement("textarea",{id:this.state.commentBodyId,class:"commentReply",rows:"3",placeholder:"Reply to this comment..."}),s.a.createElement("br",null),s.a.createElement("div",{id:"Buttons"},s.a.createElement("input",{id:"submitReplyBtn",type:"button",value:"Submit reply!",onClick:function(){return e.pushComment(e.state.commentAuthor,e.state.commentPermlink,e.state.commentBodyId)},class:"btn btn-primary"}),s.a.createElement("button",{onClick:function(){return e.handleClick()},class:"openReplies",id:"openReplies"},this.state.replyButtonValue),s.a.createElement("div",{id:"UpVote"},s.a.createElement(ce,{author:this.state.commentAuthor,permlink:this.state.commentPermlink,id:this.state.numericId,history:this.props.history})),s.a.createElement("div",{class:"list-group",id:"postComments"},this.state.comments.map(function(t){return e.state.expanded?s.a.createElement("div",null," ",t," "):null})," ")))}}]),t}(n.Component),me=Object(M.a)({},oe),pe=new v.Client("https://api.steemit.com"),he=new v.Client(se,me),de=function(e){function t(e){var a;Object(i.a)(this,t),a=Object(l.a)(this,Object(u.a)(t).call(this,e));var n=Q();return a.state={parentAuthor:a.props.author,parentPermlink:a.props.permlink,comments:[],account:n.account,key:n.key},a.pushComment=a.pushComment.bind(Object(D.a)(Object(D.a)(a))),a.fetchComments(a.state.parentAuthor,a.state.parentPermlink,-1,a.fetchComments),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"fetchComments",value:function(e,t,a,n){var o=this,r=[];pe.database.call("get_content_replies",[e,t]).then(function(e){for(var t=0;t<e.length;t++)-1===a?r.push(s.a.createElement(ue,{comment:e[t],pushComment:o.pushComment,fetchComments:n,id:"commentBody"+t,history:o.props.history})):r.push(s.a.createElement(ue,{comment:e[t],pushComment:o.pushComment,fetchComments:n,id:"commentBody"+a+"-"+t,history:o.props.history}));o.setState({comments:r})}).catch(function(e){alert("Error occured: "+e)})}},{key:"pushComment",value:function(e,t,a){if(null!=this.state.account){var n;try{n=v.PrivateKey.fromString(this.state.key)}catch(l){return console.error(l),"private key network id mismatch"===l.message?(alert("Bad password, please login again."),void this.props.history.push("/Login")):(alert("An error occurred when generating key. See console for details."),void this.props.history.push("/"))}if(""!==document.getElementById(a).value){var s=document.getElementById(a).value,o=e,r=t,i=Math.random().toString(36).substring(2),c={author:this.state.account,title:"",body:s,parent_author:o,parent_permlink:r,permlink:i,json_metadata:""};console.log("pustCSlient.broadcast.comment payload:",c),he.broadcast.comment(c,n).then(function(e){console.log("client.broadcast.comment response",e),alert("Success.")},function(e){if(console.error(e),e.message.includes("unknown key"))return alert("Bad username, please login again."),void this.props.history.push("/Login");alert("An error occurred when broadcasting. See console for details.")})}else alert("Please fill out all fields.")}else this.props.history.push("/Login")}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"CommentFeed",class:"container"},s.a.createElement("br",null),s.a.createElement("hr",null),s.a.createElement("h4",null,"Submit a comment:"),"Comment body:",s.a.createElement("br",null),s.a.createElement("textarea",{id:"commentBodyRoot",class:"Replybody",rows:"3",placeholder:"Reply to this post..."}),s.a.createElement("br",null),s.a.createElement("input",{id:"submitCommentBtn",type:"button",value:"Submit comment!",onClick:function(){return e.pushComment(e.state.parentAuthor,e.state.parentPermlink,"commentBodyRoot")},class:"btn btn-primary"}),s.a.createElement("div",{id:"postLink"}),s.a.createElement("h1",null,"Comments"),s.a.createElement("hr",null),s.a.createElement("div",{class:"list-group",id:"postComments"},this.state.comments.map(function(e){return s.a.createElement("div",null," ",e," ")})))}}]),t}(n.Component),ge=new v.Client("https://api.steemit.com"),be=a(112),fe=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={author:e.match.params.author,permlink:e.match.params.permlink,comments:[]},a.openPost(),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"openPost",value:function(){ge.database.call("get_content",[this.state.author,this.state.permlink]).then(function(e){var t=new be({html:!0,linkify:!0}).render(e.body),a="<div class='pull-right'></div><br><h2 class='title'>".concat(e.title,"</h2><br class='content'>").concat(t,"<br>");document.getElementById("postBody").style.display="block",document.getElementById("postBody").innerHTML=a}).catch(function(e){alert("Error occured: "+e)})}},{key:"render",value:function(){return s.a.createElement("div",{className:"Post"},s.a.createElement("div",{id:"postBody"}),s.a.createElement("div",{id:"upVote"},s.a.createElement(ce,{author:this.state.author,permlink:this.state.permlink,id:"Root",history:this.props.history})),s.a.createElement(de,{history:this.props.history,author:this.state.author,permlink:this.state.permlink,getAccessToken:this.props.getAccessToken,getAPI:this.props.getAPI}))}}]),t}(n.Component),ve=(a(298),a(98)),ye=a.n(ve),ke=(a(398),Object(M.a)({},oe)),Oe=new v.Client(se,ke),Ce=function(){return s.a.createElement("div",{id:"toolbar"},s.a.createElement("span",{className:"ql-formats"},s.a.createElement("button",{className:"ql-bold"}),s.a.createElement("button",{className:"ql-italic"}),s.a.createElement("button",{className:"ql-strike"})),s.a.createElement("span",{className:"ql-formats"},s.a.createElement("button",{className:"ql-list",value:"bullet"}),s.a.createElement("button",{className:"ql-list",value:"ordered"}),s.a.createElement("button",{className:"ql-blockquote"})),s.a.createElement("span",{className:"ql-formats"},s.a.createElement("button",{className:"ql-link"}),s.a.createElement("button",{className:"ql-image"})),s.a.createElement("span",{className:"ql-formats"},s.a.createElement("span",{className:"ql-header"},s.a.createElement("span",{className:"ql-picker-label"}),s.a.createElement("span",{className:"ql-picker-options"}),s.a.createElement("select",{className:"ql-header"},s.a.createElement("option",{false:!0}),s.a.createElement("option",{value:"3"}),s.a.createElement("option",{value:"2"}),s.a.createElement("option",{value:"1"})))))};function je(){var e=this.quill.getSelection(),t=prompt("Enter image URL");t&&this.quill.insertEmbed(e.index,"image",t,ve.Quill.sources.USER)}var Ee=function(e){function t(e){var a;Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={postSubmitted:!1,postBody:""};var n,s=Q();if(null==s.account)return a.props.history.push("/Login"),Object(l.a)(a);try{n=v.PrivateKey.fromString(s.key)}catch(o){return console.error(o),"private key network id mismatch"===o.message?(alert("Bad password, please login again."),a.props.history.push("/Login"),Object(l.a)(a)):(alert("An error occurred when generating key. See console for details."),a.props.history.push("/"),Object(l.a)(a))}return a.state={account:s.account,privateKey:n,editor:!1,editorButtonValue:"Switch to editor",modules:{toolbar:{container:"#toolbar",handlers:{image:je}}}},a.pushPost=a.pushPost.bind(Object(D.a)(Object(D.a)(a))),a.switchEditor=a.switchEditor.bind(Object(D.a)(Object(D.a)(a))),a.handleChange=a.handleChange.bind(Object(D.a)(Object(D.a)(a))),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"pushPost",value:function(){var e=this;if(""!==document.getElementById("title").value&&""!==this.state.postBody&&""!==document.getElementById("tags").value){var t=document.getElementById("title").value,a=document.getElementById("tags").value.split(" ");if(a.includes("chess")){var n=JSON.stringify({tags:a}),s=Math.random().toString(36).substring(2);this.setState({permlink:s});var o={author:this.state.account,body:this.state.postBody,json_metadata:n,parent_author:"",parent_permlink:a[0],permlink:s,title:t};console.log("client.broadcast.comment:",o),Oe.broadcast.comment(o,this.state.privateKey).then(function(t){alert("Success."),e.setState({postSubmitted:!0}),document.getElementById("submitPostBtn").disabled=!0},function(e){if(console.error(e),e.message.includes("unknown key"))return alert("Bad username, please login again."),void this.props.history.push("/Login");alert("An error occurred when broadcasting. See console for details.")})}else alert("Tags must contain 'chess'")}else alert("Please fill out all fields.")}},{key:"switchEditor",value:function(){this.state.editor?("<p><br></p>"===this.state.postBody&&this.setState({postBody:""}),this.setState({editor:!1}),this.setState({editorButtonValue:"Switch to editor"})):(this.setState({editor:!0}),this.setState({editorButtonValue:"Switch to markdown"}))}},{key:"handleChange",value:function(e){if(this.state.editor)this.setState({postBody:e});else{var t=document.getElementById("body").value;this.setState({postBody:t})}}},{key:"render",value:function(){var e,t=this;return s.a.createElement("div",{class:"container",id:"content"},s.a.createElement("br",null),s.a.createElement("h4",null,"Submit a post to the Steem blockchain"),"Title of post: ",s.a.createElement("input",Object(B.a)({id:"title",class:"input",type:"text",size:"65"},"class","form-control")),s.a.createElement("br",null),s.a.createElement("button",{id:"switchEditorBtn",class:"smallBtn",onClick:this.switchEditor},this.state.editorButtonValue),this.state.editor?s.a.createElement("div",{className:"text-editor"},s.a.createElement(Ce,null),s.a.createElement(ye.a,{modules:this.state.modules,placeholder:"Write your post here...",defaultValue:this.state.postBody,onChange:this.handleChange})):s.a.createElement("textarea",{id:"body",class:"form-control",rows:"3",onChange:this.handleChange,placeholder:"Write your post here...",defaultValue:this.state.postBody}),s.a.createElement("br",null),"Tags: ",s.a.createElement("input",(e={id:"tags",class:"input",type:"text",size:"65"},Object(B.a)(e,"class","form-control"),Object(B.a)(e,"defaultValue","chess"),e)),s.a.createElement("br",null),s.a.createElement("em",null,"Separate tags with spaces."),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("input",Object(B.a)({id:"submitPostBtn",class:"smallBtn",type:"button",value:"Submit post!",onClick:function(){return t.pushPost()}},"class","btn btn-primary")),s.a.createElement("br",null),this.state.postSubmitted?s.a.createElement(p.a,{to:"Post/@".concat(this.state.account,"/").concat(this.state.permlink)},s.a.createElement("h1",null,"View new post")):null)}}]),t}(n.Component),we=(a(84),a(399),a(191)),Se=(a(400),a(15)),De=a(137),Te=new Se.Client("https://api.steemit.com"),xe=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={filterValue:"",availableGames:[],selected:null,selectedData:null},a.processor=null,a.getFormattedTime=a.getFormattedTime.bind(Object(D.a)(Object(D.a)(a))),a.joinClicked=a.joinClicked.bind(Object(D.a)(Object(D.a)(a))),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.findGameRequests()}},{key:"componentWillUnmount",value:function(){null!=this.processor&&this.processor.stop()}},{key:"findGameRequests",value:function(){var e=Object(S.a)(w.a.mark(function e(){var t,a,n,s=this;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Trying to find game requests"),t=[],a=9e5,e.next=5,this.props.findBlockHead(Te);case 5:n=e.sent,this.processor=De(Te,Se,Math.max(0,n-350),0,"steem-chess-","latest"),this.processor.on("post-game",function(e){console.log("found BLOCK",e);var n=e.data;if(n.pKey=e.pKey,Date.now()-n.time<a){var o=t.indexOf(n.username);if(o>=0){var r=Object(N.a)(s.state.availableGames);r[o]=n,s.setState({availableGames:r})}else t.push(n.username),s.setState(function(e){return{availableGames:[].concat(Object(N.a)(e.availableGames),[n])}})}}),this.processor.on("request-closed",function(e){var a=t.indexOf(e.username);if(a>=0){t.splice(a,1);var n=Object(N.a)(s.state.availableGames);n.splice(a,1),s.setState({availableGames:n})}}),this.processor.start();case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getFormattedTime",value:function(e){var t=new Date(e),a=t.getHours(),n="0"+t.getMinutes(),s="0"+t.getSeconds();return a+":"+n.substr(-2)+":"+s.substr(-2)}},{key:"optionsSplitter",value:function(e,t){var a=e.split("|");return a.length>t+1?a[t]:""}},{key:"getTimePerSide",value:function(e){return this.optionsSplitter(e,1)}},{key:"getTimeControlChosen",value:function(e){return this.optionsSplitter(e,0)}},{key:"joinClicked",value:function(e){this.props.onJoinGameClicked()}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"playBox"},s.a.createElement("div",null,s.a.createElement("h1",null,"Join Game")),s.a.createElement("div",{id:"join-table-div"},s.a.createElement(we.a,{data:this.state.availableGames,columns:[{Header:"Name",id:"name",accessor:"username"},{Header:"Type",id:"type",accessor:function(t){return e.getTimeControlChosen(t.typeID)}},{Header:"Time",id:"time",accessor:function(t){return e.getTimePerSide(t.typeID)}},{Header:"Posted",id:"posted",accessor:function(t){return e.getFormattedTime(t.time)}}],getTrProps:function(t,a){return a&&a.row?{onClick:function(){e.setState({selected:a.index,selectedData:a.original})},style:{background:a.index===e.state.selected?"#4CAF50":"white",color:a.index===e.state.selected?"white":"black"}}:{}},showPagination:!1,noDataText:"No games found",className:"table",resizable:!1})),s.a.createElement("button",{id:"join-game-button",className:"Button",onClick:this.joinClicked},"Join Game"))}}]),t}(n.Component),qe=(a(401),a(185)),Pe=a.n(qe),Be=a(186),Me=a.n(Be),Ne=a(187),Re=a.n(Ne),Le=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={timeControlOptions:["Real Time","Correspondence"],timeControlChosen:"Real Time",pieceChosen:"Random",startingColorText:"Starting Color: Random",timePerSide:5,increment:5},a.pieceChanged=a.pieceChanged.bind(Object(D.a)(Object(D.a)(a))),a.timePerSideChanged=a.timePerSideChanged.bind(Object(D.a)(Object(D.a)(a))),a.incrementChanged=a.incrementChanged.bind(Object(D.a)(Object(D.a)(a))),a.timeControlChosen=a.timeControlChosen.bind(Object(D.a)(Object(D.a)(a))),a.grabGameData=a.grabGameData.bind(Object(D.a)(Object(D.a)(a))),a.createClicked=a.createClicked.bind(Object(D.a)(Object(D.a)(a))),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"pieceChanged",value:function(e){this.setState({pieceChosen:e}),this.setState({startingColorText:"Starting Color: "+e})}},{key:"timePerSideChanged",value:function(e){this.setState({timePerSide:e})}},{key:"incrementChanged",value:function(e){this.setState({increment:e})}},{key:"timeControlChosen",value:function(e){this.setState({timeControlChosen:e})}},{key:"grabGameData",value:function(){return{startingColor:this.state.pieceChosen,username:null,time:Date.now(),typeID:this.state.timeControlChosen+"|"+this.state.timePerSide+"|"+this.state.increment}}},{key:"createClicked",value:function(){this.props.onCreateGameClicked()}},{key:"render",value:function(){return s.a.createElement("div",{className:"playBox"},s.a.createElement("h1",null,"Create Game"),s.a.createElement("div",null,s.a.createElement("hr",{noshade:"true",className:"Line"}),s.a.createElement("h3",{className:"Line"},"Time Per Side"),s.a.createElement(re,{min:"1",max:"10",value:this.state.timePerSide,step:"0.5",unit:"Minutes",onValueChanged:this.timePerSideChanged}),s.a.createElement("h3",{className:"Line"},"Increment"),s.a.createElement(re,{min:"1",max:"10",value:this.state.increment,step:"1",unit:"Seconds",onValueChanged:this.incrementChanged}),s.a.createElement("hr",{noshade:"true",className:"Line"}),s.a.createElement("h3",{className:"Line"},this.state.startingColorText),s.a.createElement(Ge,{pieceChosen:this.state.pieceChosen,onPieceChanged:this.pieceChanged}),s.a.createElement("button",{className:"Button",onClick:this.createClicked},"Create Game")))}}]),t}(n.Component);var Ge=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={pieceChosen:a.props.pieceChosen?a.props.pieceChosen:"",colorChoices:[[Pe.a,"Black"],[Me.a,"Random"],[Re.a,"White"]]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"pieceClicked",value:function(e){this.setState({pieceChosen:e.target.id}),this.props.onPieceChanged(e.target.id)}},{key:"render",value:function(){var e=this,t=this.state.colorChoices.map(function(t,a){var n=Object(T.a)(t,2),o=n[0],r=n[1];return s.a.createElement("img",{key:a,id:r,onClick:function(t){return e.pieceClicked(t)},className:r===e.state.pieceChosen?"selectedPiece":"chessPiece",src:o,alt:r})});return s.a.createElement("span",{className:"pieceListSpan"},t)}}]),t}(n.Component),Ie=a(188),Ae=a.n(Ie),He=a(33),Ue=a.n(He),Ve=a(97),Fe=a.n(Ve),Ke=a(97),_e=a(15),We=a(137),Je=a(100),ze=new _e.Client("https://api.steemit.com"),Ye="steem-chess-",$e=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).transactor=Je(ze,_e,Ye),a.processor=null,a.username=null,a.posting_key=null,a.peer=null,a.optionClicked=!1,a.createGameComponent=s.a.createRef(),a.joinGameComponent=s.a.createRef(),a.gameRequestBlocks=[],a.closeRequestBlocks=[],a.findBlockHead=a.findBlockHead.bind(Object(D.a)(Object(D.a)(a))),a.createGameClicked=a.createGameClicked.bind(Object(D.a)(Object(D.a)(a))),a.joinGameClicked=a.joinGameClicked.bind(Object(D.a)(Object(D.a)(a))),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"generatePersonalKey",value:function(){this.personalRSA=Ke.generateRSAKey(Math.random().toString(),1024),this.publicKey=Ke.publicKeyString(this.personalRSA)}},{key:"encrypt",value:function(e,t){if(void 0!==t){var a=Ke.encrypt(e.toString(),t);return"success"===a.status?a.cipher:(console.error("Failed to encrypt message"),null)}console.error("Tried to encrypt without a key")}},{key:"decrypt",value:function(e){var t=Fe.a.decrypt(e.toString(),this.personalRSA);return"success"===t.status?t.plaintext:(console.error("Failed to decrypt message"),null)}},{key:"getStringHashCode",value:function(e){var t,a=0;if(0===e.length)return a;for(t=0;t<e.length;t++)a=(a<<5)-a+e.charCodeAt(t),a|=0;return a}},{key:"componentWillUnmount",value:function(){null!==this.processor&&this.processor.stop(),clearTimeout(this.failedToJoinTimeout),clearTimeout(this.createGameTimeout),Ue.a.publish("spinner",{spin:!1})}},{key:"componentDidMount",value:function(){var e=Q();if(null!=e.account){this.username=e.account;try{this.posting_key=_e.PrivateKey.fromString(e.key)}catch(t){return console.error(t),"private key network id mismatch"===t.message?(alert("Bad password."),void this.props.history.push("/Login")):(alert("An error occurred when generating key. See console for details."),void this.props.history.push("/"))}this.generatePersonalKey()}else this.props.history.push("/Login")}},{key:"findBlockHead",value:function(){var e=Object(S.a)(w.a.mark(function e(t){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,a){null==t&&a("client is null");try{t.database.getDynamicGlobalProperties().then(function(t){e(t.head_block_number)})}catch(n){console.error(n),a("Failed to find block head")}}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"findWaitingPlayers",value:function(){var e=Object(S.a)(w.a.mark(function e(t){var a,n=this;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;break;case 2:return e.next=4,this.findBlockHead(ze);case 4:a=e.sent,this.processor=We(ze,_e,Math.max(0,a-150),1,Ye,"latest");try{this.processor.on("post-game",function(e){console.log("Game block found",e),n.matchableGames(t,e.data)&&n.gameRequestBlocks.push(e)}),this.processor.on("request-closed",function(e){console.log("Close request found",e),n.matchableGames(t,e)&&n.closeRequestBlocks.push(e)}),this.processor.start()}catch(s){console.error(s),null!==this.processor&&this.processor.stop(),console.error("Failed to check for waiting players")}case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"checkWaitingPlayers",value:function(){if(console.log("finding the best game to connect to"),null!==this.processor&&this.processor.stop(),this.gameRequestBlocks.length>0){for(var e=[],t=this.gameRequestBlocks.length-1;t>=0;--t){var a=this.gameRequestBlocks[t];!e.includes(a.data.username)&&Date.now()-a.data.time<3e5&&e.push(a)}for(var n=this.closeRequestBlocks.length-1;n>=0;--n){var s=this.closeRequestBlocks[n],o=e.indexOf(s.username);if(o>=0){var r=e[o];s.time===r.time&&e.splice(o,1)}}if(e.length>0)return e[0]}}},{key:"matchableGames",value:function(e,t){return e.typeID===t.typeID&&("Random"===e.startingColor||e.startingColor!==t.startingColor)}},{key:"sendGameRequest",value:function(){var e=Object(S.a)(w.a.mark(function e(t){var a=this;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){console.log("sending request to existing game"),a.gameData.startingColor=a.decideRandom(a.gameData.startingColor,t.startingColor),t.startingColor=a.decideRandom(t.startingColor,a.gameData.startingColor),a.transactor.json(a.username,a.posting_key.toString(),"request-join",{data:t,pKey:a.publicKey},function(s,o){s?(console.error(s),n(s),alert("Failed to send game request")):o&&(console.log("sent request to existing game",a.gameData),a.opponentUsername=t.username,a.initializePeer(!1),e())})}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"decideRandom",value:function(e,t){return"Random"!==e?e.toString():"Black"===t?"White":"White"===t?"Black":Math.random()<.5?"White":"Black"}},{key:"postGameRequest",value:function(){var e=Object(S.a)(w.a.mark(function e(){var t=this;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,a){console.log("posting a new game request"),t.transactor.json(t.username,t.posting_key.toString(),"post-game",{data:t.gameData,pKey:t.publicKey},function(n,s){n?(console.error(n),a(n),alert("Failed to request game")):s&&(console.log("posted game request",s),t.listenForJoinTag(s.block_num),e())})}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"listenForJoinTag",value:function(e){var t=this;this.processor=We(ze,_e,e,100,Ye);try{this.processor.on("request-join",function(e){console.log("Listen for join tag block",e);var a=e.data;t.username===a.username&&t.gameData.typeID===a.typeID&&(console.log("accepted join block"),t.gameData.startingColor=e.data.startingColor,t.opponentUsername=e.username,t.opponentKey=e.pKey,t.initializePeer(!0))}),this.processor.start()}catch(a){console.error(a),null!==this.processor&&this.processor.stop(),alert("Game request failed")}this.failedToJoinTimeout=setTimeout(function(){null==t.peer&&(null!==t.processor&&t.processor.stop(),Ue.a.publish("spinner",{spin:!1}),alert("Failed to find opponent within 5 minutes"))},3e5)}},{key:"initializePeer",value:function(){var e=Object(S.a)(w.a.mark(function e(t){var a,n,s,o=this;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;break;case 2:return a=!0===t?"signal-i":"signal-ni",n=!0===t?"signal-ni":"signal-i",console.log("starting initializePeer"),this.peer=new Ae.a({initiator:t,trickle:!1}),this.peer.on("error",function(e){console.error(e),alert("Failed to connect to opponent :(")}),this.peer.on("signal",function(e){o.sendSignalToUser(n,e)}),this.peer.on("connect",function(){!0===t&&o.transactor.json(o.username,o.posting_key.toString(),"request-closed",o.gameData,function(e){e&&console.error(e)}),o.props.history.push({pathname:"/Live",gameData:o.gameData,peer:o.peer}),console.log("Connected to peer!")}),e.next=11,this.findBlockHead(ze);case 11:s=e.sent,this.processor=We(ze,_e,s,100,Ye),this.processor.on(a,function(e){if(null!==o.peer){var t=JSON.parse(o.decrypt(e.signal));null==t?console.error("Failed to decrypt incoming RTC signal"):o.peer.signal(t)}}),this.processor.start();case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendSignalToUser",value:function(e,t){console.log("starting sendSignalToUser");var a=this.encrypt(JSON.stringify(t),this.opponentKey);this.transactor.json(this.username,this.posting_key.toString(),e,{signal:a,from:this.username},function(e){e&&(console.error(e),alert("Failed opponent connection process"))})}},{key:"createGameClicked",value:function(){var e=this;this.optionClicked||(this.optionClicked=!0,this.gameData=this.createGameComponent.current.grabGameData(),this.gameData.username=this.username,Ue.a.publish("spinner",{spin:!0}),this.findWaitingPlayers(this.gameData),this.createGameTimeout=setTimeout(function(){var t=e.checkWaitingPlayers();null==t?e.postGameRequest():(e.opponentKey=t.pKey,e.sendGameRequest(t.data))},15e3))}},{key:"joinGameClicked",value:function(){if(!this.optionClicked){this.optionClicked=!0;var e=this.joinGameComponent.current.state.selectedData;null!=e?(this.opponentKey=e.pKey,this.gameData={startingColor:"Random",username:this.username,time:e.time,typeID:e.typeID},Ue.a.publish("spinner",{spin:!0}),this.sendGameRequest(e)):console.error("Opponent data null")}}},{key:"render",value:function(){return s.a.createElement("div",{className:"horizontal play-div"},s.a.createElement(Le,{ref:this.createGameComponent,onCreateGameClicked:this.createGameClicked}),s.a.createElement(xe,{ref:this.joinGameComponent,onJoinGameClicked:this.joinGameClicked,findBlockHead:this.findBlockHead}))}}]),t}(n.Component),Qe=(a(497),function(e){function t(e){var a;return Object(i.a)(this,t),a=Object(l.a)(this,Object(u.a)(t).call(this,e)),null!==localStorage.getItem("login")&&(localStorage.removeItem("account"),localStorage.removeItem("pKey"),localStorage.removeItem("login")),a.state={account:"",password:""},a.handleAccountChange=a.handleAccountChange.bind(Object(D.a)(Object(D.a)(a))),a.handlePasswordChange=a.handlePasswordChange.bind(Object(D.a)(Object(D.a)(a))),a.handleLogin=a.handleLogin.bind(Object(D.a)(Object(D.a)(a))),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"handleAccountChange",value:function(){var e=Object(S.a)(w.a.mark(function e(t){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setState({account:t.target.value});case 2:console.log(this.state.account);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handlePasswordChange",value:function(){var e=Object(S.a)(w.a.mark(function e(t){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setState({password:t.target.value});case 2:console.log(this.state.password);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleLogin",value:function(e){!function(e,t,a){try{localStorage.setItem("account",e),localStorage.setItem("pKey",t),localStorage.setItem("login",a)}catch(n){}}(this.state.account,this.state.password,"loggedIn"),this.props.history.push("/")}},{key:"render",value:function(){return s.a.createElement("div",{className:"Login"},s.a.createElement("form",null,s.a.createElement("label",null,"Account:",s.a.createElement("input",{type:"text",value:this.state.account,onChange:this.handleAccountChange,id:"Account"})),s.a.createElement("br",null),s.a.createElement("label",null,"Password:",s.a.createElement("input",{type:"password",value:this.state.password,onChange:this.handlePasswordChange,id:"Password"})),s.a.createElement("br",null),s.a.createElement("button",{onClick:this.handleLogin,id:"submit"},"Login")))}}]),t}(n.Component)),Xe=a(189),Ze=a.n(Xe),et=(a(498),function(e){function t(e){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,this.props.enabled?s.a.createElement("img",{className:"spinner",src:Ze.a,alt:"spinner"}):null)}}]),t}(n.Component)),tt=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={spinning:!1},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;Ue.a.subscribe("spinner",function(t,a){e.setState({spinning:a.spin})})}},{key:"componentWillUnmount",value:function(){Ue.a.unsubscribe(this.spinnerToken)}},{key:"render",value:function(){var e=this;return s.a.createElement(b.a,null,s.a.createElement("div",{className:"App"},s.a.createElement(et,{enabled:this.state.spinning}),s.a.createElement(h,null),s.a.createElement(g,null,s.a.createElement(f.a,{path:"/",render:function(e){return s.a.createElement(j,Object.assign({},e,{limit:"10",sortMethod:"trending"}))},exact:!0}),s.a.createElement(f.a,{path:"/Hot",render:function(e){return s.a.createElement(j,Object.assign({},e,{limit:"10",sortMethod:"hot"}))},exact:!0}),s.a.createElement(f.a,{path:"/New",render:function(e){return s.a.createElement(j,Object.assign({},e,{limit:"10",sortMethod:"created"}))},exact:!0}),s.a.createElement(f.a,{path:"/Play",render:function(t){return s.a.createElement($e,Object.assign({},t,{getAccessToken:e.getAccessToken}))},exact:!0}),s.a.createElement(f.a,{path:"/Live",render:function(t){return s.a.createElement(te,Object.assign({},t,{getAccessToken:e.getAccessToken}))},exact:!0}),s.a.createElement(f.a,{path:"/Post/@:author/:permlink",component:fe,exact:!0}),s.a.createElement(f.a,{path:"/UpVote/",component:ce,exact:!0}),s.a.createElement(f.a,{path:"/Compose",component:Ee,exact:!0}),s.a.createElement(f.a,{path:"/Login",component:Qe,exact:!0})),s.a.createElement(d,null)))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(b.a,null,s.a.createElement(tt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},84:function(e,t,a){},99:function(e,t,a){}},[[192,1,2]]]);
//# sourceMappingURL=main.f694251e.chunk.js.map